- job-template:
   name: entitlement-cdn-testing-trigger
   node: ftan_test_6.5
   wrappers:
        - ansicolor
        - workspace-cleanup
   parameters:
        - string:
            name: Manifest_URL
            default: http://hp-z220-11.qe.lab.eng.nay.redhat.com/projects/content-sku/manifests/rhcmsys8/15017-package-manifest.json
            description: It should be a json format file. and if no 'PID' and 'Variant' parameters, will do the testing according to this manifest content.
        - string:
            name: Distro
            default: RHEL-7.2-20150904.0
            description: Distro version in Beaker used to do testing, such as RHEL-7.2-20150904.0.
        - choice:
            name: CDN
            choices:
              - QA
              - Prod
            description:
        - choice:
            name: Candlepin
            choices:
              - Stage
              - Prod
            description:
        - string:
            name: Product_ID
            default: 
            description: Optional, you can specify PID only, or use it together with the following 'Variant' parameter.
        - extended-choice:
            name: Variant
            description: Optional, you can specify Variant only, or use it together with above 'PID' parameter.
            type: 'PT_CHECKBOX'
            value: Server-i386,Server-x86_64,Server-ppc,Server-ppc64,Server-ppc64le,Server-aarch64,Server-s390x,Client-i386,Client-x86_64,Workstation-i386,Workstation-x86_64,ComputeNode-x86_64
            visible-item-count: "12"
   scm:
        - git:
            url: 'https://github.com/tanfengshuang/entitlement-validation'
            branches:
                - origin/master
            basedir: entitlement-validation
   builders:
        - shell: |
            #!/bin/bash
            echo $Manifest_URL > $WORKSPACE/manifest.txt
            echo MANIFEST_URL=$Manifest_URL > baseinfo.txt
            echo DISTRO=$Distro >> baseinfo.txt
            echo CDN=$CDN >> baseinfo.txt
            echo CANDLEPIN=$Candlepin >> baseinfo.txt
            echo $PID >> pid.txt
            echo $Variant >> variant.txt
            python $WORKSPACE/entitlement-validation/manifest/parse.py

   publishers:
      - archive:
          artifacts: '*.txt, *.json'
          allow-empty: 'true'
      - trigger-parameterized-builds:
          - project: 'entitlement-cdn-Server_x86_64'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: Server-x86_64.properties
            fail-on-missing: true
          - project: 'entitlement-cdn-Server_i386'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: Server-i386.properties
            fail-on-missing: true           
          - project: 'entitlement-cdn-Server_ppc'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: Server-ppc.properties
            fail-on-missing: true 
          - project: 'entitlement-cdn-Server_ppc64'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: Server-ppc64.properties
            fail-on-missing: true 
          - project: 'entitlement-cdn-Server_ppc64le'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: Server-ppc64le.properties
            fail-on-missing: true 
          - project: 'entitlement-cdn-Server_aarch64'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: Server-aarch64.properties
            fail-on-missing: true 
          - project: 'entitlement-cdn-Server_s390x'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: Server-s390x.properties
            fail-on-missing: true 
          - project: 'entitlement-cdn-Client_x86_64'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: Client-x86_64.properties
            fail-on-missing: true 
          - project: 'entitlement-cdn-Client_i386'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: Client-i386.properties
            fail-on-missing: true 
          - project: 'entitlement-cdn-Workstation_x86_64'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: Workstation-x86_64.properties
            fail-on-missing: true 
          - project: 'entitlement-cdn-Workstation_i386'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: Workstation-i386.properties
            fail-on-missing: true 
          - project: 'entitlement-cdn-ComputeNode_x86_64'
            current-parameters: true
            condition: 'SUCCESS'
            property-file: ComputeNode-x86_64.properties
            fail-on-missing: true 

- project:
   name: entitlement-cdn-testing-trigger-jobs
   jobs:
    - entitlement-cdn-testing-trigger

